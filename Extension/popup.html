<!DOCTYPE html>
<html>
<head>
    <title>USPI Settings</title>
    <link rel="stylesheet" href="popup.css">
    <meta charset="UTF-8">
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab-button active" data-tab="allowlist-tab">Allowlist</button>
            <button class="tab-button" data-tab="sequence-builder-tab">Sequence Builder</button>
        </div>

        <!-- Allowlist Tab Content -->
        <div id="allowlist-tab" class="tab-content active">
            <h1>Allowlisted Base URLs</h1>
            <p>Manage sites where the injector can run. Add the current site's base URL or enter one manually.</p>
            <div class="add-current-site-section">
                <button id="add-current-site-button" title="Adds the base URL of the active tab">Add Current Site</button>
            </div>
            <div class="add-url-section">
                <input type="text" id="new-url-input" placeholder="e.g., https://www.example.com/">
                <button id="add-url-button">Add URL</button>
            </div>
            <ul id="url-list"><li>Loading...</li></ul>
        </div>

        <!-- Sequence Builder Tab Content -->
        <div id="sequence-builder-tab" class="tab-content">
            <h1>Build Action Sequence</h1>
            <p>Right-click elements on an allowed page and choose "Add to Sequence...". Manage, reorder, and apply the sequence here.</p>
            <div class="sequence-controls">
                <button id="add-wait-step-button">Add Wait Step</button>
                <button id="add-enter-step-button">Add Press Enter Step</button>
            </div>

            <div id="add-wait-form-container" class="add-step-form" style="display:none;">
                <label for="wait-duration-input">Duration:</label>
                <input type="number" id="wait-duration-input" min="1" value="1">
                <select id="wait-unit-select">
                    <option value="s" selected>Seconds (s)</option>
                    <option value="ms">Milliseconds (ms)</option>
                </select>
                <button id="confirm-add-wait-button">Add This Wait</button> <!-- Changed text for clarity -->
                <button id="cancel-add-wait-button">Cancel</button>
            </div>

            <ul id="sequence-list">
                <li class="no-steps">No steps added yet. Right-click on a page to begin.</li>
            </ul>
            <div class="sequence-actions">
                <button id="apply-sequence-button" class="primary-action">Apply & Reload Page</button>
                <button id="copy-sequence-url-button">Copy Full URL</button>
                <button id="clear-sequence-button" class="danger-action">Clear Sequence</button>
            </div>
            <div id="generated-url-container" style="display:none;">
                <p><strong>Generated URL:</strong></p>
                <textarea id="generated-url-output" rows="3" readonly></textarea>
            </div>
        </div>

        <div id="status-message-container">
            <div id="status-message"></div>
        </div>
    </div>
    <script src="popup.js"></script>
</body>
</html>